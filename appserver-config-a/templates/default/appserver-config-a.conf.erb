upstream appserver-config-a {
  server 127.0.0.1:8000;
}

server {
  listen 80;

  server_name  <%= @fqdn %>
  rewrite (.*) http://<%= @fqdn %> $1 permanent;
}

server {
  listen 80 default;
  server_name <%= @fqdn %>

  access_log /var/log/nginx-access.log main;

  error_log /var/log/nginx-error.log debug;

  client_max_body_size 100M;

  location / {
    include /etc/nginx/proxy.conf;

    if (!-f $request_filename) {
      proxy_pass http://appserver-config-a;
      break;
    }

  }
   # for upload_progress
   location /submissions {

#   include /etc/nginx/proxy.conf;

     # proxy to upstream server
     proxy_pass http://appserver-config-a;
     proxy_redirect default;

     # track uploads in the 'proxied' zone
     # remember connections for 30s after they finished
     track_uploads proxied 30s;
   }

   # for upload_progress
   location /events {
    include /etc/nginx/proxy.conf;

     # proxy to upstream server
     proxy_read_timeout 120;

     proxy_pass http://appserver-config-a;
     proxy_redirect default;

     # track uploads in the 'proxied' zone
     # remember connections for 30s after they finished
     track_uploads proxied 30s;
   }

  error_page 503 /503.html;
}
